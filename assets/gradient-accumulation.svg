<svg viewBox="0 0 700 500" xmlns="http://www.w3.org/2000/svg">
    <!-- Title -->
    <text x="350" y="30" text-anchor="middle" font-family="SF Pro Display" font-size="20" font-weight="600" fill="#555555">Gradient Accumulation</text>

    <!-- Left side: Without Accumulation -->
    <text x="150" y="70" text-anchor="middle" font-family="SF Pro Display" font-size="16" font-weight="600" fill="#007AFF">Without Accumulation</text>

    <!-- Batch 1 -->
    <rect x="50" y="90" width="200" height="60" fill="#FF9500" opacity="0.2" rx="8" stroke="#FF9500" stroke-width="2"/>
    <text x="150" y="115" text-anchor="middle" font-family="SF Pro Display" font-size="14" fill="#555555">Batch 1 (8 sequences)</text>
    <text x="150" y="135" text-anchor="middle" font-family="SF Mono" font-size="12" fill="#666">Forward → Backward</text>

    <!-- Arrow -->
    <path d="M 150 150 L 150 170" stroke="#FF9500" stroke-width="2" marker-end="url(#arroworange)"/>

    <!-- Update -->
    <circle cx="150" cy="185" r="25" fill="#32D74B" opacity="0.3" stroke="#32D74B" stroke-width="2"/>
    <text x="150" y="192" text-anchor="middle" font-family="SF Pro Display" font-size="14" font-weight="600" fill="#32D74B">Update</text>

    <!-- Noisy label -->
    <text x="150" y="230" text-anchor="middle" font-family="SF Mono" font-size="11" fill="#FF2D55">Noisy gradients!</text>

    <!-- Right side: With Accumulation -->
    <text x="525" y="70" text-anchor="middle" font-family="SF Pro Display" font-size="16" font-weight="600" fill="#5856D6">With Accumulation (16×)</text>

    <!-- Multiple batches stacked -->
    <rect x="425" y="90" width="200" height="40" fill="#FF9500" opacity="0.2" rx="8" stroke="#FF9500" stroke-width="2"/>
    <text x="525" y="115" text-anchor="middle" font-family="SF Mono" font-size="12" fill="#666">Batch 1 → accumulate</text>

    <rect x="425" y="135" width="200" height="40" fill="#FF9500" opacity="0.2" rx="8" stroke="#FF9500" stroke-width="2"/>
    <text x="525" y="160" text-anchor="middle" font-family="SF Mono" font-size="12" fill="#666">Batch 2 → accumulate</text>

    <text x="525" y="195" text-anchor="middle" font-family="SF Pro Display" font-size="14" fill="#666">⋮</text>

    <rect x="425" y="210" width="200" height="40" fill="#FF9500" opacity="0.2" rx="8" stroke="#FF9500" stroke-width="2"/>
    <text x="525" y="235" text-anchor="middle" font-family="SF Mono" font-size="12" fill="#666">Batch 16 → accumulate</text>

    <!-- Arrow -->
    <path d="M 525 250 L 525 270" stroke="#5856D6" stroke-width="2" marker-end="url(#arrowpurple)"/>

    <!-- Update -->
    <circle cx="525" cy="285" r="25" fill="#32D74B" opacity="0.3" stroke="#32D74B" stroke-width="2"/>
    <text x="525" y="292" text-anchor="middle" font-family="SF Pro Display" font-size="14" font-weight="600" fill="#32D74B">Update</text>

    <!-- Stable label -->
    <text x="525" y="330" text-anchor="middle" font-family="SF Mono" font-size="11" fill="#32D74B">Stable gradients!</text>

    <!-- Bottom comparison -->
    <rect x="50" y="370" width="600" height="100" fill="#f5f5f7" rx="8"/>
    <text x="350" y="395" text-anchor="middle" font-family="SF Pro Display" font-size="14" font-weight="600" fill="#555555">The Mathematics</text>
    <text x="350" y="420" text-anchor="middle" font-family="SF Mono" font-size="12" fill="#666">Left: gradient from 8 sequences (1,024 tokens)</text>
    <text x="350" y="440" text-anchor="middle" font-family="SF Mono" font-size="12" fill="#666">Right: averaged gradient from 128 sequences (16,384 tokens)</text>
    <text x="350" y="460" text-anchor="middle" font-family="SF Pro Display" font-size="12" font-weight="600" fill="#007AFF">16× more stable, same memory!</text>

    <!-- Arrow definitions -->
    <defs>
        <marker id="arroworange" markerWidth="10" markerHeight="10" refX="5" refY="3" orient="auto" markerUnits="strokeWidth">
            <path d="M0,0 L0,6 L9,3 z" fill="#FF9500" />
        </marker>
        <marker id="arrowpurple" markerWidth="10" markerHeight="10" refX="5" refY="3" orient="auto" markerUnits="strokeWidth">
            <path d="M0,0 L0,6 L9,3 z" fill="#5856D6" />
        </marker>
    </defs>
</svg>
